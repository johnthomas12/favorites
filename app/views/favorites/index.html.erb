<div class="page-header">
  <h1>
    Favorites

    <a href="/favorites/new" class="btn btn-lg btn-primary">New Favorite</a>
    <a href="/categories/new" class="btn btn-lg btn-success">New Category</a>

  </h1>
</div>

<div class="row">
  <div class="col-md-12">
    <table class="table table-striped table-hover">
      <tr>

        <th>Name</th>

        <th>Description</th>

        <th>User Rating</th>

        <th> Peer Rating </th>

        <th>Category</th>

        <th>Actions</th>
      </tr>

      <% @favorites.each do |favorite| %>
      <tr>

        <td><a href="<%= favorite.url %>"><%= favorite.name %></a></td>

        <td><%= favorite.description %></td>

      <% userid=[] %>
      <% favorite.fans.each do |user1| %>
        <% userid.push(user1.id) %>
      <% end %>

      <% if userid.any? {|a| a==current_user.id} %>

        <td> <%= favorite.ratings.find_by({:user_id => current_user.id }).number   %> </td>

      <% else %>

        <td> Not Rated </td>

      <% end %>

      <% peerrating=[] %>
      <% favorite.ratings.each do |rating1| %>
        <% if rating1.user_id == current_user.id %>
        <% else %>
        <% peerrating.push(rating1.number) %>
        <% end %>
      <% end %>

      <% if peerrating.present? %>
      <td> <%= peerrating.sum/peerrating.length %> </td>
      <% else %>
      <td> Not Rated </td>
      <% end %>


        <td><%= favorite.category.name %></td>

        <td>

          <a href="/favorites/<%= favorite.id %>" class="btn btn-primary">Show</a>
          <% if favorite.user_id == current_user.id %>
          <a href="/favorites/<%= favorite.id %>/edit" class="btn btn-warning">Edit</a>
          <% else %>
          <a href="/favorites/<%= favorite.id %>/edit1" class="btn btn-warning">Edit</a>
          <% end %>

          <a href="/delete_favorite/<%= favorite.id %>" class="btn btn-danger" rel="nofollow">Delete</a>

        </td>
      </tr>
      <% end %>
    </table>
  </div>
</div>
